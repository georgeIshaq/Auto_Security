# Vulnerability Scanner

A comprehensive vulnerability scanning system that detects security vulnerabilities in codebases using pattern matching and AI-powered context awareness.

## Features

- **Multi-language Support**: JavaScript, TypeScript, Python
- **AI-Powered Context**: Integration with Scout Agent for CVE matching and patch suggestions
- **Comprehensive Pattern Detection**: SQL injection, XSS, command injection, path traversal, hardcoded secrets, and more
- **Multiple Output Formats**: JSON, HTML, and text reports
- **Demo Repository**: Specialized scanner for the vulnerable demo app
- **CLI Interface**: Easy-to-use command-line tool

## Architecture

The vulnerability scanner consists of several components:

1. **VulnerabilityScanner**: Core scanning engine with pattern matching
2. **DemoRepositoryScanner**: Enhanced scanner for the demo repository
3. **ScoutAgent**: AI-powered threat intelligence and context
4. **CLI Tool**: Command-line interface for easy usage

## Installation

1. Install dependencies:
```bash
pip install -r requirements.txt
```

2. Start Redis Stack (required for Scout Agent):
```bash
docker run --name redis-vecdb -d -p 6379:6379 -p 8001:8001 redis/redis-stack:latest
```

3. Set up environment variables:
```bash
export OPENAI_API_KEY="your-openai-api-key"
```

## Usage

### Command Line Interface

#### Scan Demo Repository
```bash
python scan_cli.py --demo
```

#### Scan Specific Directory
```bash
python scan_cli.py --target /path/to/code
```

#### Generate HTML Report
```bash
python scan_cli.py --target /path/to/code --format html --output report.html
```

#### Scan with Verbose Output
```bash
python scan_cli.py --target /path/to/code --verbose
```

#### Disable AI Context (Faster)
```bash
python scan_cli.py --target /path/to/code --no-ai
```

### Programmatic Usage

#### Basic Scanner
```python
from vulnerability_scanner import VulnerabilityScanner

# Initialize scanner
scanner = VulnerabilityScanner()

# Scan a directory
scan_result = scanner.scan_directory("/path/to/code")

# Generate report
report = scanner.generate_report(scan_result, 'json')
print(report)
```

#### Demo Scanner
```python
from demo_scanner import DemoRepositoryScanner

# Initialize demo scanner
scanner = DemoRepositoryScanner()

# Scan demo repository
scan_result = scanner.scan_demo_repository()

# Generate demo report
report = scanner.generate_demo_report(scan_result)
print(report)
```

#### With Scout Agent Integration
```python
from vulnerability_scanner import VulnerabilityScanner
from scout_agent import ScoutAgent

# Initialize Scout Agent
scout = ScoutAgent()
scout.populate_knowledge_base()

# Initialize scanner with AI context
scanner = VulnerabilityScanner(scout)

# Scan with AI-powered context
scan_result = scanner.scan_directory("/path/to/code")
```

## Vulnerability Types Detected

### JavaScript/TypeScript
- **SQL Injection**: String concatenation in database queries
- **XSS**: Unsanitized user input in HTML output
- **Command Injection**: User input passed to system commands
- **Path Traversal**: User input in file path operations
- **Hardcoded Secrets**: Passwords, API keys, tokens in source code
- **Insecure Random**: Weak random number generation
- **Weak Crypto**: Deprecated hash functions (MD5, SHA1)
- **Insecure Deserialization**: Unsafe JSON parsing and eval usage
- **Weak Authentication**: Direct password comparisons
- **CORS Misconfiguration**: Wildcard CORS settings
- **Rate Limiting Bypass**: Vulnerable rate limiting configurations

### Python
- **SQL Injection**: String formatting in database queries
- **Command Injection**: os.system and subprocess with shell=True
- **Path Traversal**: User input in file operations
- **Deserialization**: Pickle and YAML deserialization
- **Hardcoded Secrets**: API keys and passwords in source code

## Output Formats

### JSON Report
```json
{
  "scan_metadata": {
    "scan_id": "scan_1234567890",
    "target_path": "/path/to/code",
    "total_findings": 5,
    "findings_by_severity": {
      "CRITICAL": 1,
      "HIGH": 2,
      "MEDIUM": 2
    }
  },
  "findings": [
    {
      "finding_id": "file_sql_injection_15_abc123",
      "vulnerability_type": "sql_injection",
      "severity": "HIGH",
      "confidence": 0.9,
      "file_path": "/path/to/code/app.js",
      "line_number": 15,
      "description": "SQL Injection vulnerability detected",
      "evidence": "SELECT * FROM users WHERE id = ${req.params.id}"
    }
  ]
}
```

### Text Report
```
================================================================================
VULNERABILITY SCAN REPORT
================================================================================
Scan ID: scan_1234567890
Target: /path/to/code
Total Findings: 5

SUMMARY BY SEVERITY:
----------------------------------------
  CRITICAL:   1 findings
     HIGH:   2 findings
   MEDIUM:   2 findings

DETAILED FINDINGS:
----------------------------------------

1. SQL_INJECTION - HIGH
   File: /path/to/code/app.js:15
   Confidence: 0.90
   Description: SQL Injection vulnerability detected
   Evidence: SELECT * FROM users WHERE id = ${req.params.id}
```

### HTML Report
Generates a styled HTML report with:
- Executive summary
- Findings by severity
- Detailed vulnerability information
- Code snippets
- CVE matches and patch suggestions

## AI-Powered Features

When using the Scout Agent integration, the scanner provides:

### CVE Context
- Matches detected vulnerabilities with known CVEs
- Provides CVSS scores and severity ratings
- Links to official vulnerability databases

### Patch Suggestions
- Finds proven fixes for similar vulnerabilities
- Provides code examples and implementation guidance
- Includes effectiveness scores and complexity ratings

### Threat Intelligence
- Vector similarity search for related vulnerabilities
- Historical patch patterns and best practices
- Framework-specific remediation guidance

## Configuration

### Environment Variables
- `OPENAI_API_KEY`: Required for AI-powered features
- `REDIS_URL`: Redis connection URL (default: redis://localhost:6379)

### Custom Patterns
You can extend the scanner by adding custom vulnerability patterns:

```python
# Add custom patterns
scanner.patterns['javascript']['custom_vuln'] = [
    r'your_custom_pattern_here'
]

# Update severity mapping
scanner.severity_map['custom_vuln'] = 'HIGH'

# Update confidence mapping
scanner.confidence_map['custom_vuln'] = 0.8
```

## Testing

Run the test suite:
```bash
python test_scanner.py
```

This will test:
- Basic vulnerability detection
- Demo repository scanning
- Scout Agent functionality
- Integration between components

## Demo Repository

The included demo repository (`repo_demo/`) contains intentionally vulnerable code for testing:

- **app.js**: Express.js application with various vulnerabilities
- **package.json**: Dependencies with known security issues
- **auth.js**: Authentication logic with security flaws
- **utils.js**: Utility functions with vulnerabilities

## Security Considerations

- **Authorized Targets Only**: Only scan codebases you own or have explicit permission to test
- **Safe Patterns**: The scanner uses read-only pattern matching and does not execute vulnerable code
- **Demo Repository**: The included demo repository is for educational purposes only

## Contributing

1. Add new vulnerability patterns to the `patterns` dictionary
2. Update severity and confidence mappings
3. Add new output formats or report generators
4. Improve AI integration and context matching

## License

MIT License - see LICENSE file for details.

## Support

For issues and questions:
1. Check the test suite for examples
2. Review the demo repository for vulnerable patterns
3. Examine the Scout Agent integration for AI features
4. Use the CLI tool with `--verbose` for detailed output
